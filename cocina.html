<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Cocina Sushi</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body { font-family: Arial; background:#111; color:#fff; padding:10px }
.card {
  background:#222; margin:10px 0; padding:10px;
  border-radius:8px
}
button {
  margin:5px; padding:6px 10px;
  border:none; border-radius:5px;
  cursor:pointer
}
.nuevo { background:#444 }
.preparando { background:orange }
.listo { background:limegreen }
.entregado { background:#777 }
</style>
</head>
<body>

<h2>üç£ Pedidos Cocina</h2>
<div id="lista"></div>

<script>
const API   = "https://script.google.com/macros/s/AKfycbxFTMvsq1mR55_9W--Tpck5hurue8SJSo1LNm4tIGbnTIwSgXUKVFKyVwxLEQBWEqDh/exec";
const TOKEN = "SUSHI2025";

function cargarPedidos() {
  fetch(`${API}?action=pedidos&token=${TOKEN}`)
    .then(r => r.json())
    .then(data => {
      lista.innerHTML = "";
      if (!data.length) {
        lista.innerHTML = "<p>No hay pedidos</p>";
        return;
      }

      data.forEach(p => {
        const div = document.createElement("div");
        div.className = "card " + p.estado;

        div.innerHTML = `
          <b>#${p.pedido_id}</b><br>
          ${p.cliente} (${p.tipo})<br>
          $${p.total}<br>
          Estado: <b>${p.estado}</b><br>
          <button onclick="estado(${p.pedido_id},'preparando')">Preparando</button>
          <button onclick="estado(${p.pedido_id},'listo')">Listo</button>
          <button onclick="estado(${p.pedido_id},'entregado')">Entregado</button>
        `;

        lista.appendChild(div);
      });
    });
}

function estado(id, estado) {
  fetch(API, {
    method: "POST",
    body: JSON.stringify({
      action: "estadopedido",
      token: TOKEN,
      pedido_id: id,
      estado: estado
    })
  })
  .then(r => r.json())
  .then(r => {
    if (r.notify) {
      const msg = `üç£ Hola ${r.cliente}, tu pedido #${r.pedido_id} est√° LISTO üôå`;
      window.open(
        `https://wa.me/56${r.telefono}?text=${encodeURIComponent(msg)}`,
        "_blank"
      );
    }
    cargarPedidos();
  });
}

setInterval(cargarPedidos, 5000);
cargarPedidos();
</script>

</body>
</html>

