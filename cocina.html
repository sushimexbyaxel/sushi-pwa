<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Cocina</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>

<h1>üç≥ Cocina - Pedidos</h1>
<div id="pedidos">Cargando...</div>

<script>
const API = "https://script.google.com/macros/s/AKfycbxFTMvsq1mR55_9W--Tpck5hurue8SJSo1LNm4tIGbnTIwSgXUKVFKyVwxLEQBWEqDh/exec";
const TOKEN = "SUSHI2025";

function cargarPedidos() {
  fetch(`${API}?action=pedidos&token=${TOKEN}`)
    .then(r => r.json())
    .then(data => {
      const div = document.getElementById("pedidos");
      div.innerHTML = "";

      data.forEach(p => {
        div.innerHTML += `
          <div style="border:1px solid #000; margin:10px; padding:10px;">
            <b>#${p.pedido_id}</b> - ${p.estado}<br>
            ${p.cliente} (${p.tipo})<br>
            Total: $${p.total}<br>
            <button onclick="estado(${p.pedido_id},'preparando')">Preparando</button>
            <button onclick="estado(${p.pedido_id},'listo')">Listo</button>
            <button onclick="estado(${p.pedido_id},'entregado')">Entregado</button>
          </div>
        `;
      });
    });
}

function estado(id, nuevoEstado) {
  fetch(API, {
    method: "POST",
    body: JSON.stringify({
      action: "estadoPedido",
      token: TOKEN,
      pedido_id: id,
      estado: nuevoEstado
    })
  }).then(() => cargarPedidos());
}

cargarPedidos();
setInterval(cargarPedidos, 5000);
</script>

</body>
</html>
