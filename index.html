<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Sushi</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>

<h1>ğŸ£ Sushi</h1>

<h2>MenÃº</h2>
<div id="menu"></div>

<h2>Carrito</h2>
<div id="carrito">VacÃ­o</div>
<b>Total: $<span id="total">0</span></b>

<h2>Tipo de pedido</h2>
<label>
  <input type="radio" name="tipo" value="despacho" checked onchange="toggleDir()">
  ğŸšš Despacho
</label>
<label>
  <input type="radio" name="tipo" value="retiro" onchange="toggleDir()">
  ğŸª Retiro
</label>

<div id="dirBox">
  <input id="direccion" placeholder="DirecciÃ³n despacho">
</div>

<h2>Datos cliente</h2>
<input id="cliente" placeholder="Nombre"><br>
<input id="telefono" placeholder="TelÃ©fono"><br><br>

<button onclick="enviarPedido()">Enviar pedido</button>

<script>
const API = "https://script.google.com/macros/s/AKfycbxFTMvsq1mR55_9W--Tpck5hurue8SJSo1LNm4tIGbnTIwSgXUKVFKyVwxLEQBWEqDh/exec";
const TOKEN = "SUSHI2025";

let carrito = [];

fetch(`${API}?action=menu&token=${TOKEN}`)
  .then(r => r.json())
  .then(menu => {
    const div = document.getElementById("menu");
    menu.forEach(p => {
      div.innerHTML += `
        <div style="border:1px solid #ccc; margin:5px; padding:5px;">
          <b>${p.nombre}</b> $${p.precio}<br>
          <button onclick='add(${JSON.stringify(p)})'>Agregar</button>
        </div>
      `;
    });
  });

function add(p) {
  carrito.push(p);
  renderCarrito();
}

function renderCarrito() {
  const div = document.getElementById("carrito");
  if (carrito.length === 0) {
    div.innerText = "VacÃ­o";
    document.getElementById("total").innerText = 0;
    return;
  }

  div.innerHTML = "";
  let total = 0;

  carrito.forEach((p,i) => {
    total += p.precio;
    div.innerHTML += `
      ${p.nombre} $${p.precio}
      <button onclick="remove(${i})">x</button><br>
    `;
  });

  document.getElementById("total").innerText = total;
}

function remove(i) {
  carrito.splice(i,1);
  renderCarrito();
}

function toggleDir() {
  const tipo = document.querySelector('input[name="tipo"]:checked').value;
  document.getElementById("dirBox").style.display =
    tipo === "despacho" ? "block" : "none";
}

function enviarPedido() {
  if (carrito.length === 0) {
    alert("Carrito vacÃ­o");
    return;
  }

  const tipo = document.querySelector('input[name="tipo"]:checked').value;

  fetch(API, {
    method: "POST",
    body: JSON.stringify({
      action: "nuevoPedido",
      token: TOKEN,
      tipo,
      cliente: cliente.value,
      telefono: telefono.value,
      direccion: direccion.value,
      items: carrito,
      total: carrito.reduce((s,p)=>s+p.precio,0)
    })
  })
  .then(r => r.json())
  .then(r => {
    alert("Pedido #" + r.pedido_id + " enviado");
    carrito = [];
    renderCarrito();
  });
}
</script>

</body>
</html>
